<!DOCTYPE html>
<html lang="en">
   <!-- LOC:HEAD -->
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width"><!--,maximum-scale=1">-->
      <meta name="rating" content="general">
      <meta name="description" content="New SmileBASIC Source">
      <!-- LOC:UIFRAMEWORK -->
      <link rel="stylesheet" href="uikit-3.5.5/css/uikit.min.css" />
      <script src="uikit-3.5.5/js/uikit.min.js"></script>
      <script src="uikit-3.5.5/js/uikit-icons.min.js"></script>
      <!-- LOC:MYSCRIPTS -->
      <script src="libbo.js"></script>
      <!-- LOC:STYLE -->
<style>
body {
   position: absolute;
   top: 0;
   bottom: 0;
   left: 0;
   right: 0;
}
.databar {
   background-color: #444;
   color: #AAA;
   padding: 0 0.1em;
}
a:hover { 
   color: inherit; 
}
#topnav a:hover {
   color: #CCC;
}
#leftpane {
   /*background-color: lime;*/
}
#rightpane {
   background-color: rgba(128,128,128,0.05);
   border-left: 2px solid rgba(128,128,128,0.1);
   width: 30em;
   max-width: calc(100vw - 1px);
   min-width: 10em;
}
#rightpanefooter {
   font-size: 0.7em;
   padding: 0 0.5em;
}
#navuseravatar {
   border-radius: 50rem;
}
#rightpanenav {
   background-color: rgba(128,128,128,0.1);
}
#rightpanenav a:hover {
   background-color: rgba(128,255,240,0.1);
}
/* Special styling JUST for the sidbar nav */
#rightpanenav .uk-active {  
   background-color: rgba(128,255,240,0.4);
}
#logs {
   font-family: monospace;
   font-size: 0.8em;
}
#logs time { 
   font-size: 0.8em; 
   margin: 0.15em;
   opacity: 0.6;
}
.log_debug { color: #BBB; }
.log_error { color: #C42; }
.log_warn { color: #DA6; }
.tabnav > div {
   padding: 0.1em 0;
}
#postarea {
   height: 5em;
   background-color: rgba(128,128,128,0.05);
   border-top: 2px solid rgba(128,128,128,0.1);
   padding-bottom: 1px;
}
#postarea textarea {
   resize: none;
}
</style>
      <!-- LOC:SCRIPT -->
<script>

var apiroot = "https://newdev.smilebasicsource.com/api";

window.onload = function()
{
   log.Info("Window load event");

   var ww = Utilities.ConvertRem(Utilities.WindowWidth());
   log.Debug("Width REM: " + ww);

   if(ww >= 60)
      rightpanetoggle.click();

   setupDebugLog();
   setupTechnicalInfo();
   setupUserForms();
};

// ********************
// ---- SETUP CODE ----
// ********************

function setupDebugLog()
{
   UIkit.util.on('#logsparent', 'show', function () {
      //Find the last id, only display new ones.
      log.Debug("Debug log shown, rendering new messages");
      var lastId = (logs.lastElementChild ?  Number(logs.lastElementChild.dataset.id) : 0);
      var msgBase = document.querySelector("#templates [data-log]");
      for(var i = 0; i < log.messages.length; i++)
      {
         if(log.messages[i].id > lastId)
         {
            var logMessage = msgBase.cloneNode(true);
            logMessage.innerHTML = logMessage.innerHTML
               .replace("%message%", log.messages[i].message)
               .replace("%level%", log.messages[i].level)
               .replace("%time%", log.messages[i].time);
            logMessage.setAttribute("data-id", log.messages[i].id);
            logs.appendChild(logMessage);
         }
      }
   });
}

function setupTechnicalInfo()
{
   quickApi("test/info", function(data)
   {
      technicalinfo.innerHTML = technicalinfo.innerHTML
         .replace("%apiroot%", apiroot)
         .replace("%apiversion%", data.versions.contentapi)
         .replace("%entitysystemversion%", data.versions.entitysystem);
   });
}

function setupUserForms()
{
   loginform.addEventListener("submit", function(event)
   {
      event.preventDefault();
      formStart(loginform);
      setTimeout(function()
      {
         formEnd(loginform);
         formError(loginform, "You suck");
      }, 3000);
   });
}

// ***************************
// ---- GENERAL UTILITIES ----
// ***************************

function getToken()
{
   var token = window.localStorage.getItem("usertoken");
   if(!token) return undefined;
   return JSON.parse(token);
}

function setToken(token)
{
   window.localStorage.setItem("usertoken", JSON.stringify(token));
}

function getFormInputs(form)
{
   return form.querySelectorAll("input, textarea, button, select");
}

function formStart(form)
{
   var inputs = getFormInputs(form);
   for(var i = 0; i < inputs.length; i++)
      inputs[i].setAttribute("disabled", "");
   var submit = form.querySelector("[type='submit']");
   submit.parentNode.appendChild(cloneTemplate("spinner"));
   var errors = form.querySelectorAll("[data-error]");
   for(var i = 0; i < errors.length; i++)
      errors[i].parentNode.removeChild(errors[i]);
}

function formEnd(form)
{
   var inputs = getFormInputs(form);
   for(var i = 0; i < inputs.length; i++)
      inputs[i].removeAttribute("disabled");
   var submit = form.querySelector("[type='submit']");
   submit.parentNode.removeChild(submit.parentNode.querySelector("[data-spinner]"));
}

function formError(form, error)
{
   form.appendChild(makeError(error));
}

// ***********************
// ---- TEMPLATE CRAP ----
// ***********************

function cloneTemplate(name)
{
   return document.querySelector("#templates [data-" + name + "]").cloneNode(true);
}

function makeError(message)
{
   var error = cloneTemplate("error");
   error.innerHTML = error.innerHTML.replace("%message%", message);
   return error;
}

// *************
// ---- API ----
// *************

var reqId = 0;

function quickApi(url, callback, error, postData)
{
   thisreqid = ++reqId;
   url = apiroot + "/" + url;
   error = error || function(e) { alert("Error on " + url + ":\n" + e.status + " - " + e.responseText); };

   var method = postData ? "POST" : "GET";
   log.Info("[" + thisreqid + "] " + method + ": " + url);

   var req = new XMLHttpRequest();
   req.addEventListener("loadend", function()
   {
      log.Debug("[" + thisreqid + "]: " + req.status);
      if(req.status <= 299 && req.status >= 200)
      {
         if(callback)
            callback(req.responseText ? JSON.parse(req.responseText) : null);
         else
            alert("Success: " + req.status + " - " + req.responseText);
      }
      else
      {
         error(req);
      }
   });

   req.open(method, url);
   req.setRequestHeader("accept", "application/json");
   req.setRequestHeader("Content-Type", "application/json");

   var token = getToken(); //Do this as late as possible "just in case" (it makes no difference though)
   if(token)
      req.setRequestHeader("Authorization", "Bearer " + token);

   if(postData)
      req.send(JSON.stringify(postData));
   else
      req.send();
}
</script>
   </head>
   <!-- LOC:BODY -->
   <body>
      <div id="website" class="uk-flex uk-flex-column uk-height-1-1">
         <!-- LOC:TOPNAV -->
         <div id="topnav" class="databar uk-flex-middle" uk-navbar>
            <!-- LOC:BREADCRUMBS -->
            <ul class="uk-breadcrumb uk-margin-remove-bottom">
               <li><a href=".">
                  <img uk-svg="ratio: 2" data-src="sbs.svg" class="uk-margin-small-right">
               </a></li>
            </ul>
            <!-- Just a spacer for now... maybe something will go here -->
            <div class="uk-flex-1">
            </div> 
            <!-- The burger side-menu thing-->
            <a id="rightpanetoggle" uk-icon="icon: menu; ratio: 2" href="#"
               uk-toggle="target: #rightpane; mode: click;"></a>
         </div>
         <!-- LOC:MAINWINDOW -->
         <div id="mainwindow" class="uk-flex-1 uk-grid-collapse uk-overflow-hidden" uk-grid>
            <!-- LOC:LEFTPANE -->
            <div id="leftpane" class=
              "uk-width-expand uk-flex uk-flex-column uk-height-1-1 uk-overflow-hidden">
               <!-- LOC:MAINCONTENT -->
               <div id="maincontent" class="uk-flex-1" uk-overflow-auto>
                  <p>This is a lot of text. i am hoping it will continue so long
                  and long and long that it will eventually wrap or something,
                  showing you exactly wehre the pane ends</p>
                     <button uk-toggle="target: [data-utgl]" type="button" 
         onclick="document.querySelector('#right-pane-nav > [hidden] a').click()">
                        wow</button>
               </div>
               <div id="postarea" class="uk-flex" data-utgl hidden>
                  <textarea class="uk-flex-1 uk-textarea"></textarea>
               </div>
            </div>
            <!-- LOC:RIGHTPANE -->
            <div id="rightpane" class="uk-width-auto uk-flex uk-flex-column uk-height-1-1" hidden>
               <!-- LOC:RIGHTPANENAV -->
               <div id="rightpanenav" class="tabnav uk-grid uk-grid-collapse 
                   uk-child-width-expand uk-text-center" 
                uk-switcher="swiping: false;">
      <!-- Shifted over for convenience, want to fit on one line please -->
      <div data-utgl><a href="" class="uk-display-block"
            uk-icon="icon: user; ratio: 2"></a></div>
      <div data-utgl hidden><a href="" class="uk-display-block"><img id="navuseravatar" 
            data-src="tempicon.png" width="40" height="40" uk-img></img></a></div>
      <div data-utgl hidden><a href="" class="uk-display-block" 
            uk-icon="icon: list; ratio: 2"></a></div>
      <div data-utgl hidden><a href="" class="uk-display-block" 
            uk-icon="icon: heart; ratio: 2"></a></div>
      <div><a href="" class="uk-display-block" 
            uk-icon="icon: server; ratio: 2"></a></div>
               </div>
               <!-- LOC:RIGHTPANECONTENT -->
               <ul id="rightpanecontent" class="uk-switcher uk-flex-1" uk-overflow-auto>
                  <!-- LOC:USERLOGIN -->
                  <li>
                     <div class="uk-container" uk-margin>
                        <form id="loginform" class="uk-padding-small" onsubmit="return false">
                           <fieldset class="uk-fieldset" uk-margin>
                              <legend class="uk-legend">Login</legend>
      <!-- Once again shifted over for convenience -->
      <input class="uk-input" name="username" type="text" placeholder="Username">
      <input class="uk-input" name="password" type="password" placeholder="Password">
      <div class="uk-inline">
      <input type="submit" value="Login" class="uk-button uk-button-primary">
      </div>
                           </fieldset>
                        </form>
                        <hr>
                        <form id="registerform" class="uk-padding-small" onsubmit="return false">
                           <fieldset class="uk-fieldset" uk-margin>
                              <legend class="uk-legend">Register</legend>
      <!-- Once again shifted over for convenience -->
      <input class="uk-input" name="username" type="text" placeholder="Username">
      <input class="uk-input" name="email" type="email" placeholder="Email">
      <input class="uk-input" name="password" type="password" placeholder="Password">
      <input class="uk-input" name="password2" type="password" placeholder="Confirm Password">
      <div class="uk-inline">
      <input type="submit" value="Register" class="uk-button uk-button-primary">
      </div>
                           </fieldset>
                        </form>
                        <form id="resendemailform" class="uk-padding-small" onsubmit="return false">
                           <fieldset class="uk-fieldset" uk-margin>
                              <legend class="uk-legend">Resend Confirmation</legend>
      <!-- Once again shifted over for convenience -->
      <input class="uk-input" name="email" type="email" placeholder="Email">
      <div class="uk-inline">
      <input type="submit" value="Resend email" class="uk-button uk-button-primary">
      </div>
                           </fieldset>
                        </form>
                        <form id="confirmemailform" class="uk-padding-small" onsubmit="return false">
                           <fieldset class="uk-fieldset" uk-margin>
                              <legend class="uk-legend">Confirm Account</legend>
      <!-- Once again shifted over for convenience -->
      <input class="uk-input" name="username" type="text" placeholder="Confirmation Code">
      <div class="uk-inline">
      <input type="submit" value="Confirm Account" class="uk-button uk-button-primary">
      </div>
                           </fieldset>
                        </form>
                     </div>
                  </li>
                  <!-- LOC:USER -->
                  <li>User-logged-in</li>
                  <!-- LOC:ACTIVITY -->
                  <li>list</li>
                  <!-- LOC:WATCHES -->
                  <li>heart</li>
                  <!-- LOC:LOGS -->
                  <li id="logsparent">
                     <ul id="logs" class="uk-list uk-list-striped uk-list-collapse"></ul>
                  </li>
               </ul>
               <div id="rightpanefooter" class="databar uk-flex">
                  <span class="uk-width-expand">SmileBASIC Source - 2020</span>
                  <a href="" uk-toggle="target: #aboutprivacy">About/Privacy</a>
               </div>
            </div>
         </div>
      </div>
      <!-- LOC:MODALS -->
      <div id="modals">
         <div id="aboutprivacy" uk-modal>
            <div class="uk-modal-dialog" uk-overflow-auto>
               <button class="uk-modal-close-default" type="button" uk-close></button>
               <div class="uk-modal-header">
                  <h2 class="uk-modal-title">
                     <img uk-svg="ratio: 2.5" data-src="sbs.svg" class="uk-margin-small-right">
                     SmileBASIC Source
                  </h2>
               </div>
               <div id="aboutprivacybody" class="uk-modal-body">
                  <p>
   SmileBASIC Source is a fan website for the SmileBASIC applications made by 
   <a target="_blank" href="https://smileboom.com/en/">SmileBoom</a>. These 
   applications are available on the Nintendo 3ds, Wii U, and Switch, and 
   allow you to create programs in BASIC on those systems. Our main focus is 
   <a target="_blank" href="https://www.petc4.smilebasic.com/?lang=en">SmileBasic 4</a> 
   on Switch.
                  </p>
                  <h3 class="uk-heading-divider"><span>Privacy</span></h3>
                  <p>
   We collect your email ONLY for the purposes of identification. We do not
   share any of your information with ANY outside party and do not use it
   ourselves other than for identification. Your avatars are publicly visible
   to anyone, as is your username/nickname, but this is true of all websites
   with public access. Nobody can view your email other than you.
                  </p>
                  <p>
   We track the pages you visit on this website only for your benefit. We do
   not use cookies to track or to sell your usage to outside parties. The
   tracking is mostly for easy access to pages you've previously visited.
                  </p>
                  <h3 class="uk-heading-divider"><span>Technology/Credits</span></h3>
   <p><a target="_blank" href="https://getuikit.com/">UIkit</a></p>
   <p><a target="_blank" href="https://docs.microsoft.com/en-us/aspnet/core/">ASP.NET Core</a></p>
   <p><a target="_blank" href="https://github.com/randomouscrap98/newsbs">Frontend Repo</a></p>
   <p><a target="_blank" href="https://github.com/randomouscrap98/contentapi">API Repo</a></p>
   <p>And a big thank you to: Yttria, 12me21, MasterR3C0RD, many
   more (please let me know if you want to be in this list)</p>
                  <h3 class="uk-heading-divider"><span>Technical Info</span></h3>
   <dl id="technicalinfo" class="uk-description-list">
      <dt>API Version:</dt>
      <dd>%apiversion%</dd>
      <dt>EntitySystem Version:</dt>
      <dd>%entitysystemversion%</dd>
      <dt>API ROOT:</dt>
      <dd>%apiroot%</dd>
   </dl>

                  <h3 class="uk-heading-divider"><span>Contact</span></h3>
   <h4>General contact:</h4>smilebasicsource@gmail.com
   <h4>Domain holder / Website Admin:</h4> Carlos Sanchez / randomous
                  </p>
               </div>
            </div>
         </div>
      </div>
      <!-- LOC:TEMPLATES -->
      <div id="templates" style="display: none">
         <li data-log data-id="1" class="uk-flex">
            <span class="log_%level% uk-width-expand">%message%</span>
            <time class="">%time%</time>
         </li>
         <div data-error class="uk-alert-danger" uk-alert>
            <a class="uk-alert-close" uk-close></a>
            <p>%message%</p>
         </div>
         <div data-spinner uk-spinner></div>
      </div>
   </body>
</html>
